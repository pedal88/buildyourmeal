{% extends "base.html" %}
{% import "components/typography.html" as type %}
{% import "components/cards.html" as card %}

{% block title %}The Pantry - The AI Kitchen{% endblock %}

{% block content %}
<div class="bg-white min-h-screen pb-24">
    <!-- Header -->
    <div class="bg-slate-50 border-b border-slate-200">
        <div class="max-w-screen-2xl mx-auto px-4 py-16 text-center">
            {{ type.page_header('The Pantry', '609 premium ingredients, fully stocked and photographed.') }}
        </div>
    </div>

    <!-- Control Bar (Sticky) -->
    <div class="sticky top-16 z-30 bg-white/95 backdrop-blur border-b border-slate-200 shadow-sm transition-all duration-300"
        id="controlBar">
        <div class="max-w-screen-xl mx-auto px-4 py-4">
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between">

                <!-- Search -->
                <div class="relative w-full md:w-96 group">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg class="w-5 h-5 text-slate-400 group-focus-within:text-orange-500 transition-colors"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <input type="text" id="searchInput"
                        class="block w-full p-2.5 pl-10 text-sm text-slate-900 border border-slate-300 rounded-lg bg-slate-50 focus:ring-orange-500 focus:border-orange-500 transition-all"
                        placeholder="Search ingredients (e.g. 'bacon')...">
                </div>

                <!-- Filters -->
                <div class="flex items-center gap-3 w-full md:w-auto overflow-x-auto hide-scrollbar">
                    <select id="categorySelect"
                        class="bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block p-2.5 min-w-[140px]">
                        <option value="all">All Categories</option>
                        {% for cat in categories %}
                        <option value="{{ cat }}">{{ cat|title }}</option>
                        {% endfor %}
                    </select>

                    <button onclick="resetFilters()"
                        class="text-sm font-medium text-slate-500 hover:text-orange-600 transition-colors whitespace-nowrap px-2">
                        Reset
                    </button>

                    <span class="text-xs text-slate-300 border-l border-slate-200 pl-3">
                        <span id="countDisplay" class="font-bold text-slate-700">{{ ingredients|length }}</span> items
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- The Grid -->
    <div class="max-w-screen-2xl mx-auto px-4 py-12">
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6" id="pantryGrid">
            {% for ingredient in ingredients %}
            <div class="ingredient-item transition-all duration-300" data-name="{{ ingredient.name|lower }}"
                data-category="{{ ingredient.main_category }}">

                <div
                    class="bg-white rounded-xl border border-slate-100 shadow-sm hover:shadow-md hover:border-orange-200 overflow-hidden group h-full flex flex-col">
                    <!-- Image Area -->
                    <div
                        class="aspect-square relative bg-slate-50 p-4 flex items-center justify-center overflow-hidden">
                        {% if ingredient.image_url %}
                        <img src="{{ url_for('static', filename=ingredient.image_url) }}" alt="{{ ingredient.name }}"
                            class="object-contain w-full h-full transform group-hover:scale-110 transition-transform duration-500"
                            loading="lazy">
                        {% else %}
                        <div class="text-4xl opacity-20">üì¶</div>
                        {% endif %}

                        <!-- ID Badge -->
                        <div
                            class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-black/70 text-white text-[10px] px-1.5 py-0.5 rounded">
                            #{{ ingredient.food_id }}
                        </div>
                    </div>

                    <!-- Content Area -->
                    <div class="p-4 flex-grow flex flex-col justify-between">
                        <div>
                            <p class="text-[10px] font-bold uppercase tracking-wider text-slate-400 mb-1">
                                {{ ingredient.main_category }}
                            </p>
                            <h3
                                class="font-bold text-slate-900 leading-tight group-hover:text-orange-600 transition-colors">
                                {{ ingredient.name|title }}
                            </h3>
                        </div>

                        <!-- Nutrition Mini-Matrix (User requested this) -->
                        <div
                            class="mt-4 grid grid-cols-2 gap-1 text-[10px] text-slate-500 bg-slate-50 rounded-lg p-2 border border-slate-100 opacity-60 group-hover:opacity-100 transition-opacity">
                            <div class="flex justify-between"><span>Cal</span> <span class="font-bold">{{
                                    ingredient.calories_per_100g|int if ingredient.calories_per_100g else '-' }}</span>
                            </div>
                            <div class="flex justify-between"><span>Pro</span> <span class="font-bold">{{
                                    ingredient.protein_per_100g|int if ingredient.protein_per_100g else '-' }}</span>
                            </div>
                            <div class="flex justify-between"><span>Fat</span> <span class="font-bold">{{
                                    ingredient.fat_per_100g|int if ingredient.fat_per_100g else '-' }}</span></div>
                            <div class="flex justify-between"><span>Carb</span> <span class="font-bold">{{
                                    ingredient.carbs_per_100g|int if ingredient.carbs_per_100g else '-' }}</span></div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-24">
            <span class="text-4xl block mb-4">üîç</span>
            <h3 class="text-lg font-medium text-slate-900">No ingredients found</h3>
            <p class="text-slate-500">Try adjusting your search terms.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const searchInput = document.getElementById('searchInput');
    const categorySelect = document.getElementById('categorySelect');
    const items = document.querySelectorAll('.ingredient-item');
    const emptyState = document.getElementById('emptyState');
    const countDisplay = document.getElementById('countDisplay');

    function filterItems() {
        const query = searchInput.value.toLowerCase();
        const category = categorySelect.value;
        let visibleCount = 0;

        items.forEach(item => {
            const name = item.dataset.name;
            const itemCategory = item.dataset.category;

            const matchesSearch = name.includes(query);
            const matchesCategory = category === 'all' || itemCategory === category;

            if (matchesSearch && matchesCategory) {
                item.style.display = 'block';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });

        countDisplay.textContent = visibleCount;

        if (visibleCount === 0) {
            emptyState.classList.remove('hidden');
        } else {
            emptyState.classList.add('hidden');
        }
    }

    function resetFilters() {
        searchInput.value = '';
        categorySelect.value = 'all';
        filterItems();
    }

    searchInput.addEventListener('input', filterItems);
    categorySelect.addEventListener('change', filterItems);
</script>
{% endblock %}